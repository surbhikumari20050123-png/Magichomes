<!doctype html>
<html><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MagicHome — Pay with Paytm</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="assets/styles.css"/>
</head>
<body class="bg-white text-gray-900">
<header class="bg-white sticky top-0 z-30 shadow-sm">
  <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
    <div class="text-2xl font-extrabold text-primary">MagicHome</div>
    <nav class="hidden md:flex items-center gap-6 text-sm">
      <a class="navlink" href="index.html">Home</a>
      <a class="navlink" href="my-bookings.html">My Bookings</a>
      <a class="navlink" href="login.html" id="loginBtn">Login</a>
    </nav>
  </div>
</header>

<main class="max-w-3xl mx-auto px-4 py-6">
  <h1 class="text-2xl font-bold mb-4">Pay Securely with Paytm</h1>
  <div id="summary" class="card bg-white p-4 mb-4"></div>
  <div class="card bg-white p-4 qr-box">
    <img src="assets/qr-paytm.png" alt="Paytm QR" class="w-full rounded-lg border"/>
    <div class="text-center text-sm text-gray-600 mt-2">Scan using Paytm App to complete token payment.</div>
    <div class="mt-4 flex items-center justify-center gap-3">
      <button class="px-4 py-2 btn-primary rounded" id="paidBtn">I've Paid</button>
      <div id="status" class="text-sm text-gray-700"></div>
    </div>
  </div>
</main>

<script>
// Inline functions for file:// compatibility
function money(n){ try{ return Number(n).toLocaleString(); }catch(e){ return n; } }
function qs(name){ const u=new URL(location.href); return u.searchParams.get(name); }
const apt = qs('apt') || 'APT-DEMO-123'; const pre = qs('pre') || 'PRE-DEMO-123';
// Mock data for demo mode
const mockData = {
  title: "2BHK in Kothrud, Pune #152",
  address: "123, Kothrud, Pune",
  rent: 25000
};
let rent = mockData.rent; tokenAmt = Math.max(1000, Math.round(rent*0.05));
document.getElementById('summary').innerHTML = `
  <div class="flex items-start justify-between">
    <div><div class="font-semibold">${mockData.title}</div><div class="text-sm text-gray-600">${mockData.address}</div></div>
    <div class="text-right"><div class="text-xs text-gray-500">Monthly Rent</div><div class="font-bold">₹ ${money(rent)}</div><div class="text-xs text-gray-500 mt-2">Token Amount</div><div class="font-bold text-primary">₹ ${money(tokenAmt)}</div></div>
  </div>`;
// fetch('/api/apartments/'+apt).then(r=>r.json()).then(d=>{
//   rent = Number(d.rent); tokenAmt = Math.max(1000, Math.round(rent*0.05));
//   document.getElementById('summary').innerHTML = `
//     <div class="flex items-start justify-between">
//       <div><div class="font-semibold">${d.title}</div><div class="text-sm text-gray-600">${d.address}</div></div>
//       <div class="text-right"><div class="text-xs text-gray-500">Monthly Rent</div><div class="font-bold">₹ ${money(rent)}</div><div class="text-xs text-gray-500 mt-2">Token Amount</div><div class="font-bold text-primary">₹ ${money(tokenAmt)}</div></div>
//     </div>`;
// });
document.getElementById('paidBtn').onclick = ()=>{
  const btn = document.getElementById('paidBtn');
  const st = document.getElementById('status');
  btn.disabled = true;
  btn.textContent = 'Processing...';
  st.textContent = 'Processing payment…';
  setTimeout(()=>{
    btn.textContent = 'Booking Successful!';
    st.textContent = 'Redirecting to confirmation...';
    setTimeout(()=>{
      // Mock booking for demo mode
      const mockBookingId = "BOOK-DEMO-456";
      const mockPaymentId = "PAY-DEMO-789";
      location.href = 'booking-success.html?bookingId=' + encodeURIComponent(mockBookingId) + '&paymentId=' + encodeURIComponent(mockPaymentId);
    }, 1000);
  }, 1000); // Reduced timeout for faster demo
};
</script>
</body></html>

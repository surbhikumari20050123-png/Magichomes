<!doctype html>
<html><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MagicHome — Booking Form</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="assets/styles.css"/>
</head>
<body class="bg-white text-gray-900">
<header class="bg-white sticky top-0 z-30 shadow-sm">
  <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
    <div class="text-2xl font-extrabold text-primary">MagicHome</div>
    <nav class="hidden md:flex items-center gap-6 text-sm">
      <a class="navlink" href="index.html">Home</a>
      <a class="navlink" href="my-bookings.html">My Bookings</a>
      <a class="navlink" href="login.html" id="loginBtn">Login</a>
    </nav>
  </div>
</header>

<main class="max-w-3xl mx-auto px-4 py-6">
  <h1 class="text-2xl font-bold mb-3">Book Your Apartment</h1>
  <div id="summary" class="card bg-white p-4 mb-4"></div>
  <div class="card bg-white p-4">
    <div class="grid md:grid-cols-2 gap-3">
      <input id="name" class="border p-2 rounded" placeholder="Full Name"/>
      <input id="phone" class="border p-2 rounded" placeholder="Mobile Number"/>
      <input id="email" class="border p-2 rounded" placeholder="Email ID"/>
      <input id="date" class="border p-2 rounded" type="date" placeholder="Move-in Date"/>
      <textarea id="msg" class="border p-2 rounded md:col-span-2" placeholder="Message to owner (optional)"></textarea>
      <label class="flex items-center gap-2 md:col-span-2"><input id="agree" type="checkbox"/> I agree to the terms & conditions</label>
    </div>
    <div class="mt-3">
      <button class="px-4 py-2 btn-primary rounded" id="nextBtn">Proceed to Payment</button>
    </div>
  </div>
</main>

<script>
// Inline functions for compatibility
function money(n){ try{ return Number(n).toLocaleString(); }catch(e){ return n; } }
function qs(name){ const u=new URL(location.href); return u.searchParams.get(name); }
const apt = qs('apt') || 'APT-DEMO-123'; // Default for demo
let rent=0, tokenAmt=0;
// Mock data for demo mode
const mockData = {
  title: "2BHK in Kothrud, Pune #152",
  address: "123, Kothrud, Pune",
  rent: 25000
};
rent = mockData.rent; tokenAmt = Math.max(1000, Math.round(rent*0.05));
document.getElementById('summary').innerHTML = `
  <div class="flex items-start justify-between">
    <div><div class="font-semibold">${mockData.title}</div><div class="text-sm text-gray-600">${mockData.address}</div></div>
    <div class="text-right"><div class="text-xs text-gray-500">Monthly Rent</div><div class="font-bold">₹ ${money(rent)}</div><div class="text-xs text-gray-500 mt-2">Token Amount</div><div class="font-bold text-primary">₹ ${money(tokenAmt)}</div></div>
  </div>`;
// fetch('/api/apartments/'+apt).then(r=>r.json()).then(d=>{
// rent = Number(d.rent); tokenAmt = Math.max(1000, Math.round(rent*0.05));
// document.getElementById('summary').innerHTML = `
//   <div class="flex items-start justify-between">
//     <div><div class="font-semibold">${d.title}</div><div class="text-sm text-gray-600">${d.address}</div></div>
//     <div class="text-right"><div class="text-xs text-gray-500">Monthly Rent</div><div class="font-bold">₹ ${money(rent)}</div><div class="text-xs text-gray-500 mt-2">Token Amount</div><div class="font-bold text-primary">₹ ${money(tokenAmt)}</div></div>
//   </div>`;
// });
document.getElementById('nextBtn').onclick = ()=>{
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const email = document.getElementById('email').value.trim();
  const date = document.getElementById('date').value.trim();
  const msg  = document.getElementById('msg').value.trim();
  const agree = document.getElementById('agree').checked;
  if(!name || !phone || !email || !date){ alert('Please fill all required fields'); return; }
  if(!agree){ alert('Please accept the terms'); return; }
  // Mock precheck for demo mode
  const mockPreId = "PRE-DEMO-123";
  const url = new URL('payment.html', location.origin);
  url.searchParams.set('apt', apt);
  url.searchParams.set('pre', mockPreId);
  location.href = url.toString();
  // fetch('/api/bookings/precheck',{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({ token:getToken(), apartmentId: apt, name, phone, email, movein_date: date, message: msg })})
  //   .then(r=>r.json()).then(d=>{
  //     const url = new URL('/payment.html', location.origin);
  //     url.searchParams.set('apt', apt);
  //     url.searchParams.set('pre', d.preId);
  //     location.href = url.toString();
  //   });
};
</script>
</body></html>
